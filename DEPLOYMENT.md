# Deployment Guide

This guide explains how to deploy the Gladney Family Tree application to production.

## Architecture

- **Frontend**: GitHub Pages (mrtag.com) - Static React app
- **Backend**: Render.com - FastAPI Python server
- **Database**: SQLite (stored on Render's persistent disk)

## Backend Deployment (Render.com)

### Step 1: Create Render Account
1. Go to https://render.com
2. Sign up with your GitHub account
3. Authorize Render to access your repositories

### Step 2: Deploy Backend
1. Click "New +" → "Web Service"
2. Connect your `GladneyFamilyMemories` repository
3. Render will detect the `render.yaml` file
4. Click "Apply" to use the configuration
5. Your backend will deploy automatically!

### Step 3: Get Your Backend URL
After deployment, your backend will be available at:
```
https://gladney-family-backend.onrender.com
```

**Important**: Copy this URL! You'll need it for the frontend.

### Step 4: Set Environment Variables (Optional)
In the Render dashboard:
1. Go to your service → "Environment"
2. Add any custom environment variables if needed:
   - `SECRET_KEY` - Auto-generated by Render
   - `DATABASE_URL` - Already set to `sqlite:///./tag_diary.db`

### Step 5: Create Your First User
Once deployed, you'll need to create a user. You have two options:

**Option A: Use the API directly**
```bash
curl -X POST https://gladney-family-backend.onrender.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "your_username",
    "password": "your_password",
    "email": "your@email.com",
    "full_name": "Your Name",
    "invite_code": "ADMIN_INVITE_CODE"
  }'
```

**Option B: SSH into Render and use the reset_password script**
1. In Render dashboard, go to "Shell"
2. Run:
   ```bash
   cd backend
   python reset_password.py username newpassword
   ```

## Frontend Deployment (GitHub Pages)

### Already Set Up! ✅
Your frontend is already deployed to GitHub Pages at **mrtag.com**.

### Update Frontend to Use Production Backend

After deploying the backend, update the frontend:

1. Edit `frontend/.env.production`:
   ```env
   VITE_API_URL=https://gladney-family-backend.onrender.com
   ```

2. Rebuild and deploy:
   ```bash
   cd frontend
   npm run build
   git add ../docs
   git commit -m "Update frontend to use production API"
   git push
   ```

3. Wait 1-2 minutes for GitHub Pages to rebuild

4. Visit **mrtag.com** and login!

## Database Backup

Your SQLite database is stored on Render's persistent disk. To backup:

1. In Render dashboard, go to "Shell"
2. Download the database:
   ```bash
   cat backend/tag_diary.db > /tmp/backup.db
   ```
3. Use Render's file download feature to get the backup

## Monitoring

- **Backend Status**: https://gladney-family-backend.onrender.com/docs (FastAPI auto-docs)
- **Health Check**: https://gladney-family-backend.onrender.com/api/auth/health
- **Render Dashboard**: https://dashboard.render.com

## Troubleshooting

### Backend issues:
1. Check Render logs in the dashboard
2. Verify environment variables are set
3. Check the health endpoint

### Frontend issues:
1. Verify VITE_API_URL is correct in .env.production
2. Check browser console for CORS errors
3. Ensure backend is running

### CORS errors:
The backend is configured to allow requests from:
- http://localhost:3000
- http://localhost:5173
- https://mrtag.com
- http://mrtag.com

If you get CORS errors, check `backend/app/main.py` line 29-34.

## Cost

- **GitHub Pages**: FREE
- **Render.com**: FREE tier (backend will sleep after 15 min of inactivity, wakes up in ~30 seconds)

To keep backend awake 24/7, upgrade to Render's paid tier ($7/month).

## Updates

To deploy updates:

1. **Backend**: Just push to GitHub - Render auto-deploys
2. **Frontend**: Run `npm run build` and push to GitHub

## Next Steps

1. Deploy backend to Render.com
2. Copy your backend URL
3. Update `frontend/.env.production`
4. Rebuild frontend
5. Test at mrtag.com
6. Create your first user account!
